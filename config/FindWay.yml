app:
  description: ''
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: FindWay
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/ollama:0.0.8@22213ae036605d41ea73bdd16908e03de1b9d5ab4656a49b8fb0343723f4cb4a
    version: null
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: junjiem/db_query:0.0.9@1060683d13870d0cb77d47664e5100a16a2029dada24cf1193bc2ce312295764
    version: null
kind: app
version: 0.5.0
workflow:
  conversation_variables:
  - description: ''
    id: ec6d3c4f-84ef-4dd5-b903-694dfcfa4e72
    name: history
    selector:
    - conversation
    - history
    value: {}
    value_type: object
  environment_variables:
  - description: æ•°æ®åº“åº“å
    id: 56ac13b3-1a9a-44b0-849b-35f41ace4df0
    name: db_dbname
    selector:
    - env
    - db_dbname
    value: advantech
    value_type: string
  - description: æ•°æ®åº“å¯†ç 
    id: 85d9d836-44e9-488c-942d-f10e85604882
    name: db_password
    selector:
    - env
    - db_password
    value: $t@k@Pp$
    value_type: secret
  - description: æ•°æ®åº“ç”¨æˆ·å
    id: c2e75a02-0572-41cf-b838-4c56f6758e35
    name: db_user
    selector:
    - env
    - db_user
    value: advantech
    value_type: string
  - description: æ•°æ®åº“ç«¯å£
    id: 636ea467-3d4a-4abc-a450-4656078c6955
    name: db_port
    selector:
    - env
    - db_port
    value: 65432
    value_type: integer
  - description: æ•°æ®åº“åœ°å€
    id: fc885452-9c1d-4644-9956-5f948cf275c0
    name: db_url
    selector:
    - env
    - db_url
    value: 172.22.132.124
    value_type: string
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: code
      id: 1763455017267-source-1763456330302-target
      source: '1763455017267'
      sourceHandle: source
      target: '1763456330302'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1763456330302-source-1763537072150-target
      source: '1763456330302'
      sourceHandle: source
      target: '1763537072150'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: tool
      id: 1763537072150-true-1763537100131-target
      source: '1763537072150'
      sourceHandle: 'true'
      target: '1763537100131'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: tool
        targetType: code
      id: 1763537100131-source-1763537122273-target
      source: '1763537100131'
      sourceHandle: source
      target: '1763537122273'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 1763537072150-false-1763537122273-target
      source: '1763537072150'
      sourceHandle: 'false'
      target: '1763537122273'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: llm
      id: 1763537122273-source-1763541974403-target
      source: '1763537122273'
      sourceHandle: source
      target: '1763541974403'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1763541974403-source-1763542717099-target
      source: '1763541974403'
      sourceHandle: source
      target: '1763542717099'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: assigner
        targetType: answer
      id: 1763543535398-source-answer-target
      source: '1763543535398'
      sourceHandle: source
      target: answer
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: if-else
      id: 1763454997438-source-1763543585810-target
      source: '1763454997438'
      sourceHandle: source
      target: '1763543585810'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: knowledge-retrieval
      id: 1763543585810-true-1763455017267-target
      source: '1763543585810'
      sourceHandle: 'true'
      target: '1763455017267'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 1763543585810-false-1763543663363-target
      source: '1763543585810'
      sourceHandle: 'false'
      target: '1763543663363'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: llm
      id: 1763543663363-source-1763543636361-target
      source: '1763543663363'
      sourceHandle: source
      target: '1763543636361'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1763543636361-source-1763544545262-target
      source: '1763543636361'
      sourceHandle: source
      target: '1763544545262'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1763542717099-source-1763599040454-target
      source: '1763542717099'
      sourceHandle: source
      target: '1763599040454'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: assigner
      id: 1763599040454-true-1763543535398-target
      source: '1763599040454'
      sourceHandle: 'true'
      target: '1763543535398'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: assigner
      id: 1763599040454-false-1763599061830-target
      source: '1763599040454'
      sourceHandle: 'false'
      target: '1763599061830'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: answer
      id: 1763599061830-source-answer-target
      source: '1763599061830'
      sourceHandle: source
      target: answer
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1763544545262-source-1763599680152-target
      source: '1763544545262'
      sourceHandle: source
      target: '1763599680152'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: assigner
      id: 1763599680152-true-1763599691633-target
      source: '1763599680152'
      sourceHandle: 'true'
      target: '1763599691633'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: assigner
      id: 1763599680152-false-1763599705501-target
      source: '1763599680152'
      sourceHandle: 'false'
      target: '1763599705501'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: if-else
      id: 1763599705501-source-1763544683634-target
      source: '1763599705501'
      sourceHandle: source
      target: '1763544683634'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: if-else
      id: 1763599691633-source-1763544683634-target
      source: '1763599691633'
      sourceHandle: source
      target: '1763544683634'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: knowledge-retrieval
      id: 1763544683634-true-1763455017267-target
      source: '1763544683634'
      sourceHandle: 'true'
      target: '1763455017267'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: 1763544683634-false-1763545082926-target
      source: '1763544683634'
      sourceHandle: 'false'
      target: '1763545082926'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        selected: false
        title: ç”¨æˆ·è¾“å…¥
        type: start
        variables: []
      height: 73
      id: '1763454997438'
      position:
        x: 0
        y: 125
      positionAbsolute:
        x: 0
        y: 125
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1763542717099.answer#}}'
        selected: false
        title: ç›´æ¥å›å¤
        type: answer
        variables: []
      height: 103
      id: answer
      position:
        x: 5974
        y: 107
      positionAbsolute:
        x: 5974
        y: 107
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - cHh5TQ1kXMref1XKYV9QsnzxSiT27ievcBiXgO0r5cURtVcePfs+6z6DoC0ru3xc
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: weighted_score
          score_threshold: null
          top_k: 10
          weights:
            keyword_setting:
              keyword_weight: 0
            vector_setting:
              embedding_model_name: bge-m3:567m
              embedding_provider_name: langgenius/ollama/ollama
              vector_weight: 1
            weight_type: customized
        query_variable_selector:
        - '1763454997438'
        - sys.query
        retrieval_mode: multiple
        selected: false
        title: æ£€ç´¢äº§å“å’Œé—¨åº—
        type: knowledge-retrieval
      height: 90
      id: '1763455017267'
      position:
        x: 2816
        y: 56
      positionAbsolute:
        x: 2816
        y: 56
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "\nfunction parseToObject(str) {\n  const obj = {};\n\n  // åªæŠŠå‡ºç°åœ¨ è¡Œé¦–ã€åˆ†å·æˆ–æ¢è¡Œ\
          \ åçš„ \"key:\" è¯†åˆ«ä¸ºå­—æ®µå\n  const regex = /(^|;|\\n)\\s*([A-Za-z0-9_]+)\\s*:/g;\n\
          \  let match;\n  const keys = [];\n\n  while ((match = regex.exec(str))\
          \ !== null) {\n    // match.index æ˜¯æ•´ä¸ª match çš„èµ·å§‹ï¼ˆåŒ…å«å‰ç¼€ï¼‰ï¼Œ\n    // æ‰¾åˆ° key åœ¨\
          \ match[0] ä¸­çš„åç§»ä»¥ç®—å‡º key çš„å…¨å±€èµ·å§‹ä½ç½®\n    const fullMatch = match[0];\n    const\
          \ keyName = match[2];\n    const offsetInFull = fullMatch.indexOf(keyName);\n\
          \    const keyIndex = match.index + offsetInFull;\n    keys.push({ key:\
          \ keyName, index: keyIndex });\n  }\n\n  for (let i = 0; i < keys.length;\
          \ i++) {\n    const current = keys[i];\n    const next = keys[i + 1];\n\n\
          \    const start = current.index + current.key.length + 1; // skip `key:`\n\
          \    const end = next ? next.index : str.length;\n\n    // å–ç‰‡æ®µå¹¶å»æ‰æ”¶å°¾çš„åˆ†å·ä¸ç©ºç™½\n\
          \    let value = str.slice(start, end).trim();\n    value = value.replace(/^\\\
          s*;|;\\s*$/g, \"\").trim();\n\n    obj[current.key] = value;\n  }\n\n  return\
          \ obj;\n}\nfunction main({result}) {\n  const list = Array.from(result).map(o\
          \ => o.content)\n  const arr = list.map(o => parseToObject(o))\n  const\
          \ store = arr.filter(o => !Object.keys(o).includes('product_id'))\n  const\
          \ store_by_id = {}\n  store.forEach(o => {\n    store_by_id[String(o.store_id)]\
          \ = o\n  })\n  const product = arr.filter(o => Object.keys(o).includes('product_id'))\n\
          \  const product_store = product.map(o => String(o.store_id))\n  const unique\
          \ = [...new Set(product_store)]\n  const need_query = unique.filter(n =>\
          \ !store_by_id[n])\n  let sql = ''\n  if (need_query.length > 0) {\n   \
          \ sql = `\n      SELECT *\n      FROM test_dify.store\n      WHERE store_id\
          \ IN (${need_query.join(', ')});\n    `\n  }\n  return {\n    sql,\n  }\n\
          }"
        code_language: javascript
        outputs:
          sql:
            children: null
            type: string
        selected: false
        title: å¤„ç†æ£€ç´¢ç»“æœ
        type: code
        variables:
        - value_selector:
          - '1763455017267'
          - result
          value_type: array[object]
          variable: result
      height: 52
      id: '1763456330302'
      position:
        x: 3156.5714285714284
        y: 75
      positionAbsolute:
        x: 3156.5714285714284
        y: 75
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: not empty
            id: f1d9c918-bc18-4733-9328-76658a0f482d
            value: ''
            varType: string
            variable_selector:
            - '1763456330302'
            - sql
          id: 'true'
          logical_operator: and
        selected: false
        title: æ˜¯å¦éœ€è¦é¢å¤–æŸ¥è¯¢é—¨åº—
        type: if-else
      height: 124
      id: '1763537072150'
      position:
        x: 3500
        y: 39
      positionAbsolute:
        x: 3500
        y: 39
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        is_team_authorization: true
        paramSchemas:
        - auto_generate: null
          default: mysql
          form: llm
          human_description:
            en_US: Used for selecting the database type, mysql, oracle, oracle11g,
              postgresql or mssql.
            ja_JP: Used for selecting the database type, mysql, oracle, oracle11g,
              postgresql or mssql.
            pt_BR: Used for selecting the database type, mysql, oracle, oracle11g,
              postgresql or mssql.
            zh_Hans: ç”¨äºé€‰æ‹©æ•°æ®åº“ç±»å‹ï¼Œmysqlã€oracleã€oracle11gã€postgresqlæˆ–mssqlã€‚
          label:
            en_US: Database type
            ja_JP: Database type
            pt_BR: Database type
            zh_Hans: æ•°æ®åº“ç±»å‹
          llm_description: ''
          max: null
          min: null
          name: db_type
          options:
          - icon: ''
            label:
              en_US: MySQL
              ja_JP: MySQL
              pt_BR: MySQL
              zh_Hans: MySQL
            value: mysql
          - icon: ''
            label:
              en_US: Oracle
              ja_JP: Oracle
              pt_BR: Oracle
              zh_Hans: Oracle
            value: oracle
          - icon: ''
            label:
              en_US: Oracle11g
              ja_JP: Oracle11g
              pt_BR: Oracle11g
              zh_Hans: Oracle11g
            value: oracle11g
          - icon: ''
            label:
              en_US: PostgreSQL
              ja_JP: PostgreSQL
              pt_BR: PostgreSQL
              zh_Hans: PostgreSQL
            value: postgresql
          - icon: ''
            label:
              en_US: Microsoft SQL Server
              ja_JP: Microsoft SQL Server
              pt_BR: Microsoft SQL Server
              zh_Hans: Microsoft SQL Server
            value: mssql
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: select
        - auto_generate: null
          default: localhost
          form: llm
          human_description:
            en_US: Database hostname or IP address (Original string, not URL-encoded
              string).
            ja_JP: Database hostname or IP address (Original string, not URL-encoded
              string).
            pt_BR: Database hostname or IP address (Original string, not URL-encoded
              string).
            zh_Hans: æ•°æ®åº“çš„ä¸»æœºåæˆ–IPåœ°å€ï¼ˆåŸå§‹å­—ç¬¦ä¸²ï¼ŒéURLç¼–ç å­—ç¬¦ä¸²ï¼‰ã€‚
          label:
            en_US: Database Host
            ja_JP: Database Host
            pt_BR: Database Host
            zh_Hans: æ•°æ®åº“åœ°å€
          llm_description: ''
          max: null
          min: null
          name: db_host
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Database port.
            ja_JP: Database port.
            pt_BR: Database port.
            zh_Hans: æ•°æ®åº“çš„ç«¯å£ã€‚
          label:
            en_US: Port
            ja_JP: Port
            pt_BR: Port
            zh_Hans: ç«¯å£
          llm_description: ''
          max: null
          min: null
          name: db_port
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: number
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Database username (Original string, not URL-encoded string).
            ja_JP: Database username (Original string, not URL-encoded string).
            pt_BR: Database username (Original string, not URL-encoded string).
            zh_Hans: æ•°æ®åº“çš„ç”¨æˆ·åï¼ˆåŸå§‹å­—ç¬¦ä¸²ï¼ŒéURLç¼–ç å­—ç¬¦ä¸²ï¼‰ã€‚
          label:
            en_US: Username
            ja_JP: Username
            pt_BR: Username
            zh_Hans: ç”¨æˆ·å
          llm_description: ''
          max: null
          min: null
          name: db_username
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Database password (Original string, not URL-encoded string).
            ja_JP: Database password (Original string, not URL-encoded string).
            pt_BR: Database password (Original string, not URL-encoded string).
            zh_Hans: æ•°æ®åº“çš„å¯†ç ï¼ˆåŸå§‹å­—ç¬¦ä¸²ï¼ŒéURLç¼–ç å­—ç¬¦ä¸²ï¼‰ã€‚
          label:
            en_US: Password
            ja_JP: Password
            pt_BR: Password
            zh_Hans: å¯†ç 
          llm_description: ''
          max: null
          min: null
          name: db_password
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: secret-input
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Database name (Original string, not URL-encoded string).
            ja_JP: Database name (Original string, not URL-encoded string).
            pt_BR: Database name (Original string, not URL-encoded string).
            zh_Hans: æ•°æ®åº“çš„åç§°ï¼ˆåŸå§‹å­—ç¬¦ä¸²ï¼ŒéURLç¼–ç å­—ç¬¦ä¸²ï¼‰ã€‚
          label:
            en_US: Database name
            ja_JP: Database name
            pt_BR: Database name
            zh_Hans: åº“å
          llm_description: ''
          max: null
          min: null
          name: db_name
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: 'Database properties, for example: alt_host=host1&alt_host=host2&ssl_cipher=%2Fpath%2Fto%2Fcrt'
            ja_JP: 'Database properties, for example: alt_host=host1&alt_host=host2&ssl_cipher=%2Fpath%2Fto%2Fcrt'
            pt_BR: 'Database properties, for example: alt_host=host1&alt_host=host2&ssl_cipher=%2Fpath%2Fto%2Fcrt'
            zh_Hans: æ•°æ®åº“å±æ€§ï¼Œä¾‹å¦‚ï¼šalt_host=host1&alt_host=host2&ssl_cipher=%2Fpath%2Fto%2Fcrt
          label:
            en_US: Database properties
            ja_JP: Database properties
            pt_BR: Database properties
            zh_Hans: æ•°æ®åº“å±æ€§
          llm_description: ''
          max: null
          min: null
          name: db_properties
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: 'SQL query statement, for example: select * from tbl_name'
            ja_JP: 'SQL query statement, for example: select * from tbl_name'
            pt_BR: 'SQL query statement, for example: select * from tbl_name'
            zh_Hans: SQLæŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚ï¼šselect * from tbl_name
          label:
            en_US: Query SQL
            ja_JP: Query SQL
            pt_BR: Query SQL
            zh_Hans: SQLæŸ¥è¯¢è¯­å¥
          llm_description: 'SQL query statement, for example: select * from tbl_name'
          max: null
          min: null
          name: query_sql
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: markdown
          form: form
          human_description:
            en_US: Used for selecting the output format, markdown or json.
            ja_JP: Used for selecting the output format, markdown or json.
            pt_BR: Used for selecting the output format, markdown or json.
            zh_Hans: ç”¨äºé€‰æ‹©è¾“å‡ºæ ¼å¼ï¼Œmarkdownæˆ–jsonã€‚
          label:
            en_US: Output format
            ja_JP: Output format
            pt_BR: Output format
            zh_Hans: è¾“å‡ºæ ¼å¼
          llm_description: ''
          max: null
          min: null
          name: output_format
          options:
          - icon: ''
            label:
              en_US: MARKDOWN
              ja_JP: MARKDOWN
              pt_BR: MARKDOWN
              zh_Hans: MARKDOWN
            value: markdown
          - icon: ''
            label:
              en_US: JSON
              ja_JP: JSON
              pt_BR: JSON
              zh_Hans: JSON
            value: json
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: select
        params:
          db_host: ''
          db_name: ''
          db_password: ''
          db_port: ''
          db_properties: ''
          db_type: ''
          db_username: ''
          output_format: ''
          query_sql: ''
        plugin_id: junjiem/db_query
        plugin_unique_identifier: junjiem/db_query:0.0.9@1060683d13870d0cb77d47664e5100a16a2029dada24cf1193bc2ce312295764
        provider_icon: http://172.22.132.124:8081/console/api/workspaces/current/plugin/icon?tenant_id=de79cda4-cae0-4be5-8bff-50ddcacf186f&filename=ce2ce5af47e39e9476fc06eea7fbd05446ad16043d4d16c671e69a3c650a976a.svg
        provider_id: junjiem/db_query/db_query
        provider_name: junjiem/db_query/db_query
        provider_type: builtin
        selected: false
        title: SQLæŸ¥è¯¢é—¨åº—
        tool_configurations:
          output_format:
            type: constant
            value: markdown
        tool_description: æ•°æ®åº“SQLæŸ¥è¯¢å·¥å…·ã€‚
        tool_label: SQLæŸ¥è¯¢
        tool_name: sql_query
        tool_node_version: '2'
        tool_parameters:
          db_host:
            type: mixed
            value: '{{#env.db_url#}}'
          db_name:
            type: mixed
            value: '{{#env.db_dbname#}}'
          db_password:
            type: mixed
            value: '{{#env.db_password#}}'
          db_port:
            type: variable
            value:
            - env
            - db_port
          db_properties:
            type: mixed
            value: null
          db_type:
            type: constant
            value: postgresql
          db_username:
            type: mixed
            value: '{{#env.db_user#}}'
          query_sql:
            type: mixed
            value: '{{#1763456330302.sql#}}'
        type: tool
      height: 88
      id: '1763537100131'
      position:
        x: 3875.0582584494414
        y: -191.521123925147
      positionAbsolute:
        x: 3875.0582584494414
        y: -191.521123925147
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "\nfunction parseToObject(str) {\n  const obj = {};\n\n  // åªæŠŠå‡ºç°åœ¨ è¡Œé¦–ã€åˆ†å·æˆ–æ¢è¡Œ\
          \ åçš„ \"key:\" è¯†åˆ«ä¸ºå­—æ®µå\n  const regex = /(^|;|\\n)\\s*([A-Za-z0-9_]+)\\s*:/g;\n\
          \  let match;\n  const keys = [];\n\n  while ((match = regex.exec(str))\
          \ !== null) {\n    // match.index æ˜¯æ•´ä¸ª match çš„èµ·å§‹ï¼ˆåŒ…å«å‰ç¼€ï¼‰ï¼Œ\n    // æ‰¾åˆ° key åœ¨\
          \ match[0] ä¸­çš„åç§»ä»¥ç®—å‡º key çš„å…¨å±€èµ·å§‹ä½ç½®\n    const fullMatch = match[0];\n    const\
          \ keyName = match[2];\n    const offsetInFull = fullMatch.indexOf(keyName);\n\
          \    const keyIndex = match.index + offsetInFull;\n    keys.push({ key:\
          \ keyName, index: keyIndex });\n  }\n\n  for (let i = 0; i < keys.length;\
          \ i++) {\n    const current = keys[i];\n    const next = keys[i + 1];\n\n\
          \    const start = current.index + current.key.length + 1; // skip `key:`\n\
          \    const end = next ? next.index : str.length;\n\n    // å–ç‰‡æ®µå¹¶å»æ‰æ”¶å°¾çš„åˆ†å·ä¸ç©ºç™½\n\
          \    let value = str.slice(start, end).trim();\n    value = value.replace(/^\\\
          s*;|;\\s*$/g, \"\").trim();\n\n    obj[current.key] = value;\n  }\n\n  return\
          \ obj;\n}\nfunction main({result, text}) {\n  let stores = []\n  if (!!text)\
          \ {\n    const md = String(text).replace(/(?<!\\|)\\n(?!\\|)/g, ' ').replaceAll('\\\
          r', ' ')\n    const lines = md.split('\\n')\n    const parseRow = (line)\
          \ => line.trim().replace(/^\\|/, '').replace(/\\|$/, '').split('|').map(col\
          \ => col.trim())\n    const head = parseRow(lines[0])\n    const body =\
          \ lines.slice(2)\n    stores = body.map(line => {\n      const cols = parseRow(line)\n\
          \      const obj = {}\n      head.forEach((h, i) => {\n        obj[h] =\
          \ cols[i] ?? \"\";\n      })\n      return obj\n    })\n  }\n  const list\
          \ = Array.from(result).map(o => o.content)\n  const arr = list.map(o =>\
          \ parseToObject(o))\n  const store = arr.filter(o => !Object.keys(o).includes('product_id'))\n\
          \  const store_by_id = {}\n  store.forEach(o => {\n    const obj = {}\n\
          \    obj.store_id = o.store_id\n    Object.keys(o).forEach(key => {\n  \
          \    if (key !== 'store_id') {\n        obj[`store_${key}`] = o[key]\n \
          \     }\n    })\n    store_by_id[String(o.store_id)] = obj\n  })\n  stores.forEach(o\
          \ => {\n    const obj = {}\n    obj.store_id = o.store_id\n    Object.keys(o).forEach(key\
          \ => {\n      if (key !== 'store_id') {\n        obj[`store_${key}`] = o[key]\n\
          \      }\n    })\n    store_by_id[String(o.store_id)] = obj\n  })\n  const\
          \ product = arr.filter(o => Object.keys(o).includes('product_id')).map(o\
          \ => {\n    return {\n      ...o,\n      ...(store_by_id[o.store_id] ||\
          \ {})\n    }\n  })\n  const str_s = store.map(obj => {\n    return Object.entries(obj)\n\
          \      .map(([key, val]) => `${key}: ${val}`)\n      .join('; ')\n  })\n\
          \  const str_p = product.map(obj => {\n    return Object.entries(obj)\n\
          \      .map(([key, val]) => `${key}: ${val}`)\n      .join('; ')\n  })\n\
          \  return {\n    store: str_s,\n    product: str_p,\n    store_obj: store,\n\
          \    product_obj: product,\n  }\n}"
        code_language: javascript
        outputs:
          product:
            children: null
            type: array[string]
          product_obj:
            children: null
            type: array[object]
          store:
            children: null
            type: array[string]
          store_obj:
            children: null
            type: array[object]
        selected: false
        title: æ•´åˆç»“æœ
        type: code
        variables:
        - value_selector:
          - '1763537100131'
          - text
          value_type: string
          variable: text
        - value_selector:
          - '1763455017267'
          - result
          value_type: array[object]
          variable: result
      height: 52
      id: '1763537122273'
      position:
        x: 4224
        y: 103
      positionAbsolute:
        x: 4224
        y: 103
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            num_ctx: 20480
            temperature: 0
          mode: chat
          name: qwen3:8b
          provider: langgenius/ollama/ollama
        prompt_template:
        - id: f88d6267-561b-42de-a5bf-352f9ebd9a70
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½äº§å“ä¸é—¨åº—ç­›é€‰åŠ©æ‰‹ï¼Œè¯·åœ¨ **ä¸€æ¬¡å¤„ç†** ä¸­å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼Œå¹¶ä¸¥æ ¼éµå®ˆæ‰€æœ‰è§„åˆ™ã€‚\n\n---\n\n## 1ï¸âƒ£ ä¸¥æ ¼ç­›é€‰ç›¸å…³ç»“æœ\n\
            \n* **ä»…æ ¹æ®ç”¨æˆ·é—®é¢˜è¿›è¡Œç­›é€‰ï¼Œä¸å¾—æ›´æ”¹ã€è¡¥å……ã€æ¨æµ‹æˆ–ä¿®æ­£ä»»ä½•äº§å“æˆ–é—¨åº—æ•°æ®ã€‚**\n* è¾“å‡ºå¿…é¡»æ˜¯ä¸¥æ ¼ JSONï¼Œç»“æ„å¦‚ä¸‹ï¼š\n\n\
            ```json\n{\n  \"product\": [product_id...],\n  \"store\": [store_id...],\n\
            \  \"need_confirm\": true,\n  \"answer\": \"\"\n}\n```\n\nå­—æ®µè¯´æ˜ï¼š\n\n* `product`ï¼šç­›é€‰åçš„\
            \ **product_id æ•°ç»„**ï¼ˆåªè¿”å› product_idï¼Œä¸è¿”å›å…¶ä»–å­—æ®µï¼‰\n* `store`ï¼šç­›é€‰åçš„ **store_id\
            \ æ•°ç»„**ï¼ˆåªè¿”å› store_idï¼Œä¸è¿”å›å…¶ä»–å­—æ®µï¼‰\n* `need_confirm`ï¼šæ˜¯å¦éœ€è¦ç”¨æˆ·è¿›ä¸€æ­¥ç¡®è®¤\n* `answer`ï¼šæœ€ç»ˆç»™ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€å›ç­”æ–‡æœ¬\n\
            \nè¦æ±‚ï¼š\n\n* ä¿ç•™ä¸æ‰€æœ‰ç”¨æˆ·é—®é¢˜æ˜ç¡®ç›¸å…³çš„äº§å“ä¸é—¨åº— IDï¼Œä¸è¦é—æ¼ã€‚\n* ä¸å¾—ä¿®æ”¹æ•°æ®å†…å®¹ï¼Œåªèƒ½ä¿ç•™æˆ–å‰”é™¤ã€‚\n* å¦‚æœæ— ä»»ä½•åŒ¹é…ï¼š\n\
            \  `product = []`, `store = []`, `need_confirm = false`ï¼Œå¹¶åœ¨ `answer` ä¸­æç¤ºç”¨æˆ·éœ€è¦è¿›ä¸€æ­¥è¯´æ˜ã€‚\n\
            \n---\n\n## 2ï¸âƒ£ å›ç­”ç”Ÿæˆé€»è¾‘ï¼ˆåŸºäºç­›é€‰ç»“æœï¼Œä¸å¯ä¿®æ”¹æ•°æ®ï¼‰\n\n### ï¼ˆ1ï¼‰ç”¨æˆ·è¯¢é—®é—¨åº—\n\n* **å•ä¸€ç»“æœ**ï¼šè¯·ç»“åˆé—¨åº—å…·ä½“ä¿¡æ¯å›ç­”ï¼Œ`need_confirm\
            \ = false`\n* **å¤šä¸ªç»“æœ**ï¼šåˆ—å‡ºå€™é€‰é—¨åº—ä¿¡æ¯æ¸…å•ï¼Œè¯·ç”¨æˆ·é€‰æ‹©ï¼Œ`need_confirm = true`\n\n### ï¼ˆ2ï¼‰ç”¨æˆ·è¯¢é—®äº§å“\n\
            \n* **å•ä¸€ç»“æœ**ï¼šè¯·ç»“åˆäº§å“å…·ä½“ä¿¡æ¯å’Œæ‰€åœ¨é—¨åº—çš„å…·ä½“ä¿¡æ¯å›ç­”ï¼ŒåŠ¡å¿…å¸¦ä¸Šé—¨åº—ä¿¡æ¯ï¼Œ`need_confirm = false`\n*\
            \ **å¤šä¸ªç»“æœ**ï¼šåˆ—å‡ºå€™é€‰äº§å“ä¿¡æ¯æ¸…å•ï¼Œè¯·ç”¨æˆ·é€‰æ‹©ï¼Œ`need_confirm = true`\n\n### ï¼ˆ3ï¼‰æ··åˆåœºæ™¯\n\n*\
            \ ç”¨æˆ·æ‰¾äº§å“ â†’ ä¼˜å…ˆç­›é€‰äº§å“ï¼Œå¹¶æ ¹æ®éœ€è¦ç­›é€‰ç›¸å…³é—¨åº—\n* ç”¨æˆ·æ‰¾é—¨åº— â†’ ä¼˜å…ˆç­›é€‰é—¨åº—ï¼Œå¹¶æ ¹æ®éœ€è¦ç­›é€‰ç›¸å…³äº§å“\n* å…¨ç¨‹ç¦æ­¢ä¿®æ”¹ä»»ä½•äº§å“æˆ–é—¨åº—å­—æ®µå†…å®¹\n\
            \n---\n\n## âš ï¸ å¿…é¡»éµå®ˆçš„è§„åˆ™\n\n* **ç¦æ­¢ä¿®æ”¹äº§å“æˆ–é—¨åº—æ•°æ®ã€‚åªå…è®¸ç­›é€‰æˆ–æ’é™¤ã€‚**\n* **product ä¸ store\
            \ å­—æ®µåªå…è®¸è¿”å›å¯¹åº” IDï¼Œä¸å¾—è¿”å›å®Œæ•´å¯¹è±¡ã€‚**\n* JSON åªèƒ½åŒ…å«ï¼š`product`ã€`store`ã€`need_confirm`ã€`answer`\
            \ å››ä¸ªå­—æ®µã€‚\n* å¤–å±‚å¿…é¡»ä½¿ç”¨ ```json åŒ…è£¹ã€‚\n* JSON ä¸­ä¸å¾—åŒ…å«æ³¨é‡Šæˆ–é¢å¤–æ–‡æœ¬ã€‚å¿…é¡»ä¸¥æ ¼å¯è§£æã€‚"
        - id: aa62c6dc-fee9-4143-af13-156087fdfe24
          role: user
          text: 'ç”¨æˆ·é—®é¢˜ï¼š

            {{#sys.query#}}


            äº§å“æ£€ç´¢ç»“æœï¼š

            {{#1763537122273.product#}}


            é—¨åº—æ£€ç´¢ç»“æœï¼š

            {{#1763537122273.store#}}'
        selected: false
        title: LLM ç­›é€‰
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763541974403'
      position:
        x: 4566
        y: 83.57142857142858
      positionAbsolute:
        x: 4566
        y: 83.57142857142858
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "\nfunction handleLLM(text) {\n  const regex = /```json([\\s\\S]*?)```/\n\
          \  const _res = text.replaceAll(/<think>[\\s\\S]*?<\\/think>/g, '')\n  const\
          \ match = _res.match(regex);\n  const res = !!match ? match[1].trim() :\
          \ _res\n  const str = res.replaceAll(/\\/\\/.*$/gm, '').replaceAll(/\\/\\\
          *[\\s\\S]*?\\*\\//g, '')\n  let obj\n  try {\n    obj = JSON.parse(str)\n\
          \  } catch (e) {\n    obj = {}\n  }\n  return obj\n}\nfunction main({text,\
          \ query, store_obj, product_obj}) {\n  const obj = handleLLM(text)\n  const\
          \ product_id = {}\n  Array.from(product_obj).forEach(o => {\n    product_id[o.product_id]\
          \ = o\n  })\n  const store_id = {}\n  Array.from(store_obj).forEach(o =>\
          \ {\n    store_id[o.store_id] = o\n  })\n  const product = Array.isArray(obj.product)\
          \ ? Array.from(obj.product) : []\n  const store = Array.isArray(obj.store)\
          \ ? Array.from(obj.store) : []\n  const answer = obj.answer\n  const need\
          \ = !!obj.need_confirm\n  const str_s = store.map(id => {\n    const obj\
          \ = store_id[id] || {}\n    return Object.entries(obj)\n      .map(([key,\
          \ val]) => `${key}: ${val}`)\n      .join('; ')\n  })\n  const str_p = product.map(id\
          \ => {\n    const obj = product_id[id] || {}\n    return Object.entries(obj)\n\
          \      .map(([key, val]) => `${key}: ${val}`)\n      .join('; ')\n  })\n\
          \  const history = {\n    question: query,\n    answer,\n    product: str_p,\n\
          \    store: str_s,\n  }\n  return {\n    history,\n    answer,\n    need,\n\
          \  }\n}\n"
        code_language: javascript
        outputs:
          answer:
            children: null
            type: string
          history:
            children: null
            type: object
          need:
            children: null
            type: boolean
        selected: false
        title: å¤„ç†ç­›é€‰ç»“æœ
        type: code
        variables:
        - value_selector:
          - '1763541974403'
          - text
          value_type: string
          variable: text
        - value_selector:
          - sys
          - query
          value_type: string
          variable: query
        - value_selector:
          - '1763537122273'
          - product_obj
          value_type: array[object]
          variable: product_obj
        - value_selector:
          - '1763537122273'
          - store_obj
          value_type: array[object]
          variable: store_obj
      height: 52
      id: '1763542717099'
      position:
        x: 4908
        y: 103
      positionAbsolute:
        x: 4908
        y: 103
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1763542717099'
          - history
          variable_selector:
          - conversation
          - history
          write_mode: over-write
        selected: false
        title: ç¼“å­˜
        type: assigner
        version: '2'
      height: 84
      id: '1763543535398'
      position:
        x: 5612
        y: 99
      positionAbsolute:
        x: 5612
        y: 99
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: empty
            id: ddefa884-a114-42eb-b2d8-f2aee29deb3c
            value: ''
            varType: object
            variable_selector:
            - conversation
            - history
          id: 'true'
          logical_operator: and
        selected: false
        title: åˆ¤æ–­æ˜¯å¦å­˜åœ¨å†å²
        type: if-else
      height: 124
      id: '1763543585810'
      position:
        x: 342
        y: 100
      positionAbsolute:
        x: 342
        y: 100
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            num_ctx: 20480
            temperature: 0
          mode: chat
          name: qwen3:8b
          provider: langgenius/ollama/ollama
        prompt_template:
        - id: 2a6ef545-d78e-4a7e-b8c5-109e8b0ad200
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½äº§å“å’Œé—¨åº—åŠ©æ‰‹ï¼Œè¯·åœ¨ä¸€æ¬¡å¤„ç†é‡Œå®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š\n\nå·²çŸ¥ï¼š\nä¸Šä¸€è½®å¯¹è¯é—®é¢˜ï¼š{{#1763543663363.question#}}\n\
            ä¸Šä¸€è½®å¯¹è¯å›ç­”ï¼š{{#1763543663363.answer#}}\nä¸Šä¸€è½®äº§å“æ£€ç´¢ç»“æœï¼š\n{{#1763543663363.product#}}\n\
            ä¸Šä¸€è½®é—¨åº—æ£€ç´¢ç»“æœï¼š\n{{#1763543663363.store#}}\n\næœ¬è½®ç”¨æˆ·è¾“å…¥ï¼š{{#sys.query#}}\n\n---\n\
            \n## \U0001F3AF ä»»åŠ¡è¯´æ˜\n\nè¯·åŸºäºä»¥ä¸Šä¿¡æ¯è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶è¾“å‡º **ä¸¥æ ¼ JSON**ï¼ˆåªå…è®¸ JSONï¼Œä¸è¦è¾“å‡ºä»»ä½•é¢å¤–æ–‡å­—ï¼‰ã€‚\n\
            æœ€å¤–å±‚éœ€ç”± ```json ```åŒ…è£¹ï¼Œç¡®ä¿å¯è§£æã€‚\n\n---\n\n## \U0001F9E9 JSON å­—æ®µè¦æ±‚\n\n### 1.\
            \ `action` â€”â€” åˆ¤æ–­ç±»å‹\n\nå¯å–å€¼ï¼š\n\n* `\"direct_answer\"` â†’ æ»¡è¶³æ¡ä»¶çš„äº§å“/é—¨åº—åªå‰©ä¸€ä¸ªï¼Œå¯ç›´æ¥å›ç­”\n\
            * `\"further_filter\"` â†’  æ»¡è¶³æ¡ä»¶çš„äº§å“/é—¨åº—ä¸æ­¢ä¸€ä¸ªï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·è¿›ä¸€æ­¥ç­›é€‰äº§å“/é—¨åº—\n* `\"unrelated\"\
            ` â†’ æœ¬è½®é—®é¢˜ä¸ä¸Šä¸€è½®æ— å…³ï¼Œéœ€è¦é‡æ–°å¼€å§‹\n\n---\n\n### 2. `product` / `store` â€”â€” è¿›ä¸€æ­¥ç­›é€‰çš„ç»“æœ\n\
            \n* `product`:\n  æœ¬è½®ç­›é€‰åˆ°çš„ **product_id æ•°ç»„**ï¼ˆä»…è¿”å› product_idï¼Œä¸è¿”å›å…¶ä»–å­—æ®µï¼Œä¸å¾—ä¿®æ”¹å†…å®¹ï¼‰\n\
            \n* `store`:\n  æœ¬è½®ç­›é€‰åˆ°çš„ **store_id æ•°ç»„**ï¼ˆä»…è¿”å› store_idï¼Œä¸è¿”å›å…¶ä»–å­—æ®µï¼Œä¸å¾—ä¿®æ”¹å†…å®¹ï¼‰\n\n\
            å¯¹äº `action = \"unrelated\"` æ—¶ï¼Œè¿™ä¸¤ä¸ªå­—æ®µå¯ä»¥è¿”å›ç©ºæ•°ç»„ã€‚\n\n---\n\n### 3. `answer`\
            \ â€”â€” æœ€ç»ˆç»™ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€å›ç­”æ–‡æœ¬\n\nè¯·æ ¹æ® `action` ç±»å‹è‡ªåŠ¨ç”Ÿæˆå¯¹åº”å†…å®¹ï¼š\n\n* è‹¥ `action = \"direct_answer\"\
            `\n  â†’ å¦‚æœç”¨æˆ·é—®é—¨åº—ï¼šè¯·ç»“åˆé—¨åº—å…·ä½“ä¿¡æ¯å›ç­”\n  â†’ å¦‚æœç”¨æˆ·é—®äº§å“ï¼šè¯·ç»“åˆäº§å“å…·ä½“ä¿¡æ¯å’Œæ‰€åœ¨é—¨åº—çš„å…·ä½“ä¿¡æ¯å›ç­”ï¼ŒåŠ¡å¿…å¸¦ä¸Šé—¨åº—ä¿¡æ¯\n\
            \  â†’ æ­£ç¡®ç†è§£äº§å“å’Œé—¨åº—ä¿¡æ¯ï¼Œä¸è¦è¯¯è§£ã€ç¼–é€ ä¿¡æ¯\n\n* è‹¥ `action = \"further_filter\"`\n  â†’ åœ¨\
            \ `answer` ä¸­è¯´æ˜ï¼š\n\n    * ç”¨æˆ·å½“å‰æ„å›¾\n    * ä¸ºä»€ä¹ˆéœ€è¦è¿›ä¸€æ­¥ç­›é€‰\n    * å¦‚æœé—®é—¨åº—ï¼šåˆ—å‡ºç­›é€‰åˆ°é—¨åº—ä¿¡æ¯æ¸…å•ä¾›ç”¨æˆ·é€‰æ‹©\n\
            \    * å¦‚æœé—®äº§å“ï¼šåˆ—å‡ºç­›é€‰åˆ°äº§å“ä¿¡æ¯æ¸…å•ä¾›ç”¨æˆ·é€‰æ‹©\n\n* è‹¥ `action = \"unrelated\"`\n  â†’ åœ¨ `answer`\
            \ ä¸­è¯´æ˜æµç¨‹å·²é‡ç½®ï¼Œè¯·ç”¨æˆ·é‡æ–°æè¿°éœ€æ±‚\n\n---\n\n## âš ï¸ æ³¨æ„äº‹é¡¹ï¼ˆå¿…é¡»éµå®ˆï¼‰\n\n* **æ•´æ®µè¾“å‡ºå¿…é¡»æ˜¯ä¸¥æ ¼ JSONï¼Œä¸”åªæœ‰\
            \ JSONï¼Œæ²¡æœ‰ä»»ä½•é¢å¤–æ–‡å­—ã€‚**\n* JSON å¤–å±‚å¿…é¡»ä½¿ç”¨ ```json ``` åŒ…è£¹ã€‚\n* JSON å¿…é¡»å¯è§£æï¼Œä¸å…è®¸å‡ºç°æ³¨é‡Šæˆ–å¤šä½™ç¬¦å·ã€‚\n\
            * **product åªè¿”å› product_id æ•°ç»„ï¼Œstore åªè¿”å› store_id æ•°ç»„**ã€‚\n* **ç¦æ­¢ä¿®æ”¹äº§å“æˆ–é—¨åº—åŸå§‹æ•°æ®ï¼Œåªèƒ½ç­›é€‰æˆ–æ’é™¤ã€‚**"
        selected: false
        title: LLM å¤„ç†ç¼“å­˜
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763543636361'
      position:
        x: 1058.857142857143
        y: 294.42857142857144
      positionAbsolute:
        x: 1058.857142857143
        y: 294.42857142857144
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "\nfunction parseToObject(str) {\n  const obj = {};\n\n  // åªæŠŠå‡ºç°åœ¨ è¡Œé¦–ã€åˆ†å·æˆ–æ¢è¡Œ\
          \ åçš„ \"key:\" è¯†åˆ«ä¸ºå­—æ®µå\n  const regex = /(^|;|\\n)\\s*([A-Za-z0-9_]+)\\s*:/g;\n\
          \  let match;\n  const keys = [];\n\n  while ((match = regex.exec(str))\
          \ !== null) {\n    // match.index æ˜¯æ•´ä¸ª match çš„èµ·å§‹ï¼ˆåŒ…å«å‰ç¼€ï¼‰ï¼Œ\n    // æ‰¾åˆ° key åœ¨\
          \ match[0] ä¸­çš„åç§»ä»¥ç®—å‡º key çš„å…¨å±€èµ·å§‹ä½ç½®\n    const fullMatch = match[0];\n    const\
          \ keyName = match[2];\n    const offsetInFull = fullMatch.indexOf(keyName);\n\
          \    const keyIndex = match.index + offsetInFull;\n    keys.push({ key:\
          \ keyName, index: keyIndex });\n  }\n\n  for (let i = 0; i < keys.length;\
          \ i++) {\n    const current = keys[i];\n    const next = keys[i + 1];\n\n\
          \    const start = current.index + current.key.length + 1; // skip `key:`\n\
          \    const end = next ? next.index : str.length;\n\n    // å–ç‰‡æ®µå¹¶å»æ‰æ”¶å°¾çš„åˆ†å·ä¸ç©ºç™½\n\
          \    let value = str.slice(start, end).trim();\n    value = value.replace(/^\\\
          s*;|;\\s*$/g, \"\").trim();\n\n    obj[current.key] = value;\n  }\n\n  return\
          \ obj;\n}\nfunction main({history}) {\n  const product = Array.from(history.product).map(o\
          \ => typeof o === 'string' ? o : JSON.stringify(o))\n  const store = Array.from(history.store).map(o\
          \ => typeof o === 'string' ? o : JSON.stringify(o))\n  const product_obj\
          \ = product.map(o => parseToObject(o))\n  const store_obj = store.map(o\
          \ => parseToObject(o))\n  return {\n    question: history.question,\n  \
          \  answer: history.answer,\n    product,\n    store,\n    product_obj,\n\
          \    store_obj,\n  }\n}\n"
        code_language: javascript
        outputs:
          answer:
            children: null
            type: string
          product:
            children: null
            type: array[string]
          product_obj:
            children: null
            type: array[object]
          question:
            children: null
            type: string
          store:
            children: null
            type: array[string]
          store_obj:
            children: null
            type: array[object]
        selected: false
        title: è§£æç¼“å­˜
        type: code
        variables:
        - value_selector:
          - conversation
          - history
          value_type: object
          variable: history
      height: 52
      id: '1763543663363'
      position:
        x: 708.2857142857142
        y: 294.42857142857144
      positionAbsolute:
        x: 708.2857142857142
        y: 294.42857142857144
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "\nfunction handleLLM(text) {\n  const regex = /```json([\\s\\S]*?)```/\n\
          \  const _res = text.replaceAll(/<think>[\\s\\S]*?<\\/think>/g, '')\n  const\
          \ match = _res.match(regex);\n  const res = !!match ? match[1].trim() :\
          \ _res\n  const str = res.replaceAll(/\\/\\/.*$/gm, '').replaceAll(/\\/\\\
          *[\\s\\S]*?\\*\\//g, '')\n  let obj\n  try {\n    obj = JSON.parse(str)\n\
          \  } catch (e) {\n    obj = {}\n  }\n  return obj\n}\nfunction main({text,\
          \ query, store_obj, product_obj}) {\n  const obj = handleLLM(text)\n  const\
          \ action = obj.action\n  const product_id = {}\n  Array.from(product_obj).forEach(o\
          \ => {\n    product_id[o.product_id] = o\n  })\n  const store_id = {}\n\
          \  Array.from(store_obj).forEach(o => {\n    store_id[o.store_id] = o\n\
          \  })\n  const product = Array.isArray(obj.product) ? Array.from(obj.product)\
          \ : []\n  const store = Array.isArray(obj.store) ? Array.from(obj.store)\
          \ : []\n  const answer = obj.answer\n  const need = action === 'further_filter'\n\
          \  const str_s = store.map(id => {\n    const obj = store_id[id] || {}\n\
          \    return Object.entries(obj)\n      .map(([key, val]) => `${key}: ${val}`)\n\
          \      .join('; ')\n  })\n  const str_p = product.map(id => {\n    const\
          \ obj = product_id[id] || {}\n    return Object.entries(obj)\n      .map(([key,\
          \ val]) => `${key}: ${val}`)\n      .join('; ')\n  })\n  const history =\
          \ {\n    question: query,\n    answer,\n    product: str_p,\n    store:\
          \ str_s,\n  }\n  return {\n    action,\n    need,\n    history,\n    answer,\n\
          \  }\n}\n"
        code_language: javascript
        outputs:
          action:
            children: null
            type: string
          answer:
            children: null
            type: string
          history:
            children: null
            type: object
          need:
            children: null
            type: boolean
        selected: false
        title: å¤„ç†ç»“æœ
        type: code
        variables:
        - value_selector:
          - '1763543636361'
          - text
          value_type: string
          variable: text
        - value_selector:
          - sys
          - query
          value_type: string
          variable: query
        - value_selector:
          - '1763543663363'
          - product_obj
          value_type: array[object]
          variable: product_obj
        - value_selector:
          - '1763543663363'
          - store_obj
          value_type: array[object]
          variable: store_obj
      height: 52
      id: '1763544545262'
      position:
        x: 1400.857142857143
        y: 294.42857142857144
      positionAbsolute:
        x: 1400.857142857143
        y: 294.42857142857144
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: e33b8c07-358c-48dd-9ce1-ef4ea870004f
            value: unrelated
            varType: string
            variable_selector:
            - '1763544545262'
            - action
          id: 'true'
          logical_operator: and
        selected: false
        title: åˆ¤æ–­æ˜¯å¦ç›´æ¥å›ç­”
        type: if-else
      height: 124
      id: '1763544683634'
      position:
        x: 2446.8571428571427
        y: 238.4285714285714
      positionAbsolute:
        x: 2446.8571428571427
        y: 238.4285714285714
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1763544545262.answer#}}'
        selected: false
        title: ç›´æ¥å›å¤ 3
        type: answer
        variables: []
      height: 103
      id: '1763545082926'
      position:
        x: 2816
        y: 379.5714285714286
      positionAbsolute:
        x: 2816
        y: 379.5714285714286
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: b649b90f-b6d7-4ec4-b8fe-571477d21ebc
            value: true
            varType: boolean
            variable_selector:
            - '1763542717099'
            - need
          id: 'true'
          logical_operator: and
        selected: false
        title: åˆ¤æ–­æ˜¯å¦æ¸…ç©ºç¼“å­˜
        type: if-else
      height: 124
      id: '1763599040454'
      position:
        x: 5250
        y: 67
      positionAbsolute:
        x: 5250
        y: 67
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: clear
          value: ''
          variable_selector:
          - conversation
          - history
          write_mode: over-write
        selected: false
        title: æ¸…ç©ºç¼“å­˜
        type: assigner
        version: '2'
      height: 84
      id: '1763599061830'
      position:
        x: 5612
        y: 263
      positionAbsolute:
        x: 5612
        y: 263
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 4abbe569-d014-4eda-a99c-673e9e9601f1
            value: true
            varType: boolean
            variable_selector:
            - '1763544545262'
            - need
          id: 'true'
          logical_operator: and
        selected: false
        title: åˆ¤æ–­æ˜¯å¦æ¸…ç©ºç¼“å­˜
        type: if-else
      height: 124
      id: '1763599680152'
      position:
        x: 1738.5714285714284
        y: 294.42857142857144
      positionAbsolute:
        x: 1738.5714285714284
        y: 294.42857142857144
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1763544545262'
          - history
          variable_selector:
          - conversation
          - history
          write_mode: over-write
        selected: false
        title: ç¼“å­˜
        type: assigner
        version: '2'
      height: 84
      id: '1763599691633'
      position:
        x: 2072
        y: 238.4285714285714
      positionAbsolute:
        x: 2072
        y: 238.4285714285714
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: clear
          value: ''
          variable_selector:
          - conversation
          - history
          write_mode: over-write
        selected: false
        title: æ¸…ç©ºç¼“å­˜
        type: assigner
        version: '2'
      height: 84
      id: '1763599705501'
      position:
        x: 2076.2857142857147
        y: 379.5714285714286
      positionAbsolute:
        x: 2076.2857142857147
        y: 379.5714285714286
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: -72.71229676863459
      y: 275.51043893699295
      zoom: 0.25
  rag_pipeline_variables: []
